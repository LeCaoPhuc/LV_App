"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var common = require("./image-cache-it.common");
var imageSrc = require("image-source");
var view_1 = require("tns-core-modules/ui/core/view");
global.moduleMerge(common, exports);
var ImageCacheIt = (function (_super) {
    __extends(ImageCacheIt, _super);
    function ImageCacheIt() {
        return _super.call(this) || this;
    }
    Object.defineProperty(ImageCacheIt.prototype, "ios", {
        get: function () {
            return this.nativeView;
        },
        enumerable: true,
        configurable: true
    });
    ImageCacheIt.prototype.onMeasure = function (widthMeasureSpec, heightMeasureSpec) {
        var nativeView = this.nativeView;
        if (nativeView) {
            var width = view_1.layout.getMeasureSpecSize(widthMeasureSpec);
            var height = view_1.layout.getMeasureSpecSize(heightMeasureSpec);
            this.setMeasuredDimension(width, height);
        }
    };
    ImageCacheIt.prototype.createNativeView = function () {
        return UIImageView.new();
    };
    ImageCacheIt.prototype.initNativeView = function () {
        var _this = this;
        if (!this.imageUri) {
            return;
        }
        if (this.imageUri.startsWith("http")) {
            this.isLoading = true;
            this.nativeView.sd_setImageWithURLPlaceholderImageCompleted(this.imageUri, this.placeHolder ? imageSrc.fromFileOrResource(this.placeHolder).ios : null, function () {
                _this.isLoading = false;
            });
        }
        else {
            this.nativeView.image = imageSrc.fromFileOrResource(this.imageUri).ios;
        }
        if (this.resize && this.resize !== undefined && this.resize.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.resize.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.resize.split(' ')[1]);
        }
        else if (this.override && this.override !== undefined && this.override.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.override.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.override.split(' ')[1]);
        }
    };
    ImageCacheIt.prototype[common.imageUriProperty.getDefault] = function () {
        return undefined;
    };
    ImageCacheIt.prototype[common.imageUriProperty.setNative] = function (src) {
        var _this = this;
        if (!this.imageUri) {
            return;
        }
        if (this.imageUri.startsWith("http")) {
            this.isLoading = true;
            this.nativeView.sd_setImageWithURLPlaceholderImageCompleted(this.imageUri, this.placeHolder ? imageSrc.fromFileOrResource(this.placeHolder).ios : null, function () {
                _this.isLoading = false;
            });
        }
        else {
            this.nativeView.image = imageSrc.fromFileOrResource(this.imageUri).ios;
        }
    };
    ImageCacheIt.prototype[common.resizeProperty.setNative] = function (resize) {
        if (this.resize && this.resize !== undefined && this.resize.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.resize.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.resize.split(' ')[1]);
        }
    };
    ImageCacheIt.prototype[common.overrideProperty.setNative] = function (override) {
        if (this.override && this.override !== undefined && this.override.split(' ').length > 1) {
            this.nativeView.frame.size.width = parseInt(this.override.split(' ')[0]);
            this.nativeView.frame.size.height = parseInt(this.override.split(' ')[1]);
        }
    };
    ImageCacheIt.prototype[common.stretchProperty.getDefault] = function () {
        return "aspectFit";
    };
    ImageCacheIt.prototype[common.stretchProperty.setNative] = function (value) {
        switch (value) {
            case "aspectFit":
                this.nativeView.contentMode = UIViewContentMode.ScaleAspectFit;
                break;
            case "aspectFill":
                this.nativeView.contentMode = UIViewContentMode.ScaleAspectFill;
                break;
            case "fill":
                this.nativeView.contentMode = UIViewContentMode.ScaleToFill;
                break;
            case "none":
            default:
                this.nativeView.contentMode = UIViewContentMode.TopLeft;
                break;
        }
    };
    ImageCacheIt.prototype.clearItem = function () {
        // this.builder.
    };
    return ImageCacheIt;
}(common.ImageCacheIt));
exports.ImageCacheIt = ImageCacheIt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtY2FjaGUtaXQuaW9zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW1hZ2UtY2FjaGUtaXQuaW9zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsZ0RBQWtEO0FBS2xELHVDQUEwQztBQUMxQyxzREFBNkQ7QUFDN0QsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFFcEM7SUFBa0MsZ0NBQW1CO0lBR2pEO2VBQ0ksaUJBQU87SUFDWCxDQUFDO0lBRUQsc0JBQUksNkJBQUc7YUFBUDtZQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQzNCLENBQUM7OztPQUFBO0lBRU0sZ0NBQVMsR0FBaEIsVUFBaUIsZ0JBQXdCLEVBQUUsaUJBQXlCO1FBQ2hFLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDbkMsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNiLElBQU0sS0FBSyxHQUFHLGFBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzFELElBQU0sTUFBTSxHQUFHLGFBQU0sQ0FBQyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQzVELElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDN0MsQ0FBQztJQUNMLENBQUM7SUFFTSx1Q0FBZ0IsR0FBdkI7UUFDSSxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFDTSxxQ0FBYyxHQUFyQjtRQUFBLGlCQW9CQztRQW5CRyxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFDO1lBQ2YsTUFBTSxDQUFFO1FBQ1osQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FB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ImltcG9ydCAqIGFzIGNvbW1vbiBmcm9tICcuL2ltYWdlLWNhY2hlLWl0LmNvbW1vbic7XHJcbmltcG9ydCBhcHAgPSByZXF1aXJlKFwiYXBwbGljYXRpb25cIik7XHJcbmltcG9ydCBmcyA9IHJlcXVpcmUoXCJmaWxlLXN5c3RlbVwiKTtcclxuaW1wb3J0IHV0aWxzID0gcmVxdWlyZShcInV0aWxzL3V0aWxzXCIpO1xyXG5pbXBvcnQgdHlwZXMgPSByZXF1aXJlKFwidXRpbHMvdHlwZXNcIik7XHJcbmltcG9ydCBpbWFnZVNyYyA9IHJlcXVpcmUoXCJpbWFnZS1zb3VyY2VcIik7XHJcbmltcG9ydCB7IFZpZXcsIGxheW91dCB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvdWkvY29yZS92aWV3JztcclxuZ2xvYmFsLm1vZHVsZU1lcmdlKGNvbW1vbiwgZXhwb3J0cyk7XHJcblxyXG5leHBvcnQgY2xhc3MgSW1hZ2VDYWNoZUl0IGV4dGVuZHMgY29tbW9uLkltYWdlQ2FjaGVJdCB7XHJcbiAgICBuYXRpdmVWaWV3OiBVSUltYWdlVmlldztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpb3MoKTogVUlJbWFnZVZpZXcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5hdGl2ZVZpZXc7XHJcbiAgICB9XHJcbiAgICBpc0xvYWRpbmc6IGJvb2xlYW47XHJcbiAgICBwdWJsaWMgb25NZWFzdXJlKHdpZHRoTWVhc3VyZVNwZWM6IG51bWJlciwgaGVpZ2h0TWVhc3VyZVNwZWM6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IG5hdGl2ZVZpZXcgPSB0aGlzLm5hdGl2ZVZpZXc7XHJcbiAgICAgICAgaWYgKG5hdGl2ZVZpZXcpIHtcclxuICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBsYXlvdXQuZ2V0TWVhc3VyZVNwZWNTaXplKHdpZHRoTWVhc3VyZVNwZWMpO1xyXG4gICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBsYXlvdXQuZ2V0TWVhc3VyZVNwZWNTaXplKGhlaWdodE1lYXN1cmVTcGVjKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRNZWFzdXJlZERpbWVuc2lvbih3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNyZWF0ZU5hdGl2ZVZpZXcoKSB7XHJcbiAgICAgICAgcmV0dXJuIFVJSW1hZ2VWaWV3Lm5ldygpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGluaXROYXRpdmVWaWV3KCkge1xyXG4gICAgICAgIGlmKCF0aGlzLmltYWdlVXJpKXtcclxuICAgICAgICAgICAgcmV0dXJuIDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaW1hZ2VVcmkuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAoPGFueT50aGlzLm5hdGl2ZVZpZXcpLnNkX3NldEltYWdlV2l0aFVSTFBsYWNlaG9sZGVySW1hZ2VDb21wbGV0ZWQodGhpcy5pbWFnZVVyaSwgdGhpcy5wbGFjZUhvbGRlciA/IGltYWdlU3JjLmZyb21GaWxlT3JSZXNvdXJjZSh0aGlzLnBsYWNlSG9sZGVyKS5pb3MgOiBudWxsLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5hdGl2ZVZpZXcuaW1hZ2UgPSBpbWFnZVNyYy5mcm9tRmlsZU9yUmVzb3VyY2UodGhpcy5pbWFnZVVyaSkuaW9zXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5yZXNpemUgJiYgdGhpcy5yZXNpemUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJlc2l6ZS5zcGxpdCgnICcpLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmZyYW1lLnNpemUud2lkdGggPSBwYXJzZUludCh0aGlzLnJlc2l6ZS5zcGxpdCgnICcpWzBdKTtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmZyYW1lLnNpemUuaGVpZ2h0ID0gcGFyc2VJbnQodGhpcy5yZXNpemUuc3BsaXQoJyAnKVsxXSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm92ZXJyaWRlICYmIHRoaXMub3ZlcnJpZGUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLm92ZXJyaWRlLnNwbGl0KCcgJykubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICB0aGlzLm5hdGl2ZVZpZXcuZnJhbWUuc2l6ZS53aWR0aCA9IHBhcnNlSW50KHRoaXMub3ZlcnJpZGUuc3BsaXQoJyAnKVswXSk7XHJcbiAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5mcmFtZS5zaXplLmhlaWdodCA9IHBhcnNlSW50KHRoaXMub3ZlcnJpZGUuc3BsaXQoJyAnKVsxXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgW2NvbW1vbi5pbWFnZVVyaVByb3BlcnR5LmdldERlZmF1bHRdKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIFtjb21tb24uaW1hZ2VVcmlQcm9wZXJ0eS5zZXROYXRpdmVdKHNyYzogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYoIXRoaXMuaW1hZ2VVcmkpe1xyXG4gICAgICAgICAgICByZXR1cm4gO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pbWFnZVVyaS5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xyXG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICg8YW55PnRoaXMubmF0aXZlVmlldykuc2Rfc2V0SW1hZ2VXaXRoVVJMUGxhY2Vob2xkZXJJbWFnZUNvbXBsZXRlZCh0aGlzLmltYWdlVXJpLCB0aGlzLnBsYWNlSG9sZGVyID8gaW1hZ2VTcmMuZnJvbUZpbGVPclJlc291cmNlKHRoaXMucGxhY2VIb2xkZXIpLmlvcyA6IG51bGwsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5pbWFnZSA9IGltYWdlU3JjLmZyb21GaWxlT3JSZXNvdXJjZSh0aGlzLmltYWdlVXJpKS5pb3NcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBbY29tbW9uLnJlc2l6ZVByb3BlcnR5LnNldE5hdGl2ZV0ocmVzaXplOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAodGhpcy5yZXNpemUgJiYgdGhpcy5yZXNpemUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJlc2l6ZS5zcGxpdCgnICcpLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmZyYW1lLnNpemUud2lkdGggPSBwYXJzZUludCh0aGlzLnJlc2l6ZS5zcGxpdCgnICcpWzBdKTtcclxuICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmZyYW1lLnNpemUuaGVpZ2h0ID0gcGFyc2VJbnQodGhpcy5yZXNpemUuc3BsaXQoJyAnKVsxXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgW2NvbW1vbi5vdmVycmlkZVByb3BlcnR5LnNldE5hdGl2ZV0ob3ZlcnJpZGU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0aGlzLm92ZXJyaWRlICYmIHRoaXMub3ZlcnJpZGUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLm92ZXJyaWRlLnNwbGl0KCcgJykubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICB0aGlzLm5hdGl2ZVZpZXcuZnJhbWUuc2l6ZS53aWR0aCA9IHBhcnNlSW50KHRoaXMub3ZlcnJpZGUuc3BsaXQoJyAnKVswXSk7XHJcbiAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5mcmFtZS5zaXplLmhlaWdodCA9IHBhcnNlSW50KHRoaXMub3ZlcnJpZGUuc3BsaXQoJyAnKVsxXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFtjb21tb24uc3RyZXRjaFByb3BlcnR5LmdldERlZmF1bHRdKCk6IFwiYXNwZWN0Rml0XCIge1xyXG4gICAgICAgIHJldHVybiBcImFzcGVjdEZpdFwiO1xyXG4gICAgfVxyXG4gICAgW2NvbW1vbi5zdHJldGNoUHJvcGVydHkuc2V0TmF0aXZlXSh2YWx1ZTogXCJub25lXCIgfCBcImFzcGVjdEZpbGxcIiB8IFwiYXNwZWN0Rml0XCIgfCBcImZpbGxcIikge1xyXG4gICAgICAgIHN3aXRjaCAodmFsdWUpIHtcclxuICAgICAgICAgICAgY2FzZSBcImFzcGVjdEZpdFwiOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmNvbnRlbnRNb2RlID0gVUlWaWV3Q29udGVudE1vZGUuU2NhbGVBc3BlY3RGaXQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImFzcGVjdEZpbGxcIjpcclxuICAgICAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5jb250ZW50TW9kZSA9IFVJVmlld0NvbnRlbnRNb2RlLlNjYWxlQXNwZWN0RmlsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiZmlsbFwiOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXRpdmVWaWV3LmNvbnRlbnRNb2RlID0gVUlWaWV3Q29udGVudE1vZGUuU2NhbGVUb0ZpbGw7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIm5vbmVcIjpcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRoaXMubmF0aXZlVmlldy5jb250ZW50TW9kZSA9IFVJVmlld0NvbnRlbnRNb2RlLlRvcExlZnQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGVhckl0ZW0oKSB7XHJcbiAgICAgICAgLy8gdGhpcy5idWlsZGVyLlxyXG4gICAgfVxyXG59Il19